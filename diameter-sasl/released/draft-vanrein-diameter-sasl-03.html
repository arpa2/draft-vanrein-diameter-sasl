<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Realm Crossover for SASL and GSS-API via Diameter</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Messages of GS2-SXOVER-PLUS"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Initial Client-to-Server Message"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Initial Server-to-Client Message"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Continued Client-to-Server Messages"/>
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Continued Server-to-Client Messages"/>
<link href="#rfc.section.3" rel="Chapter" title="3 GS2-SXOVER-PLUS as a GS2 Mechanism"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Encrypting GS2-SXOVER-PLUS Messages"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Initial Round-trip Optimisation"/>
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Initial Header for GSS-API"/>
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Initial Header for SASL"/>
<link href="#rfc.section.4" rel="Chapter" title="4 AVP Definitions for SASL in Diameter"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 SASL-Mechanism"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 SASL-Token"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 SASL-Channel-Binding"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Diameter Message Requirements for GS2-SXOVER-PLUS"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 C2S-Init Requests over Diameter"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 S2C-Init Responses over Diameter"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 C2S-Cont Requests over Diameter"/>
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 S2C-Cont Responses over Diameter"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Running Diameter as a SASL Backend"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Diameter is an SCTP service"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Reliance on DANE and DNSSEC"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations"/>
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations"/>
<link href="#rfc.references" rel="Chapter" title="9 Normative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Acknowledgements"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Van Rein, R." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-vanrein-diameter-sasl-03" />
  <meta name="dct.issued" scheme="ISO8601" content="2020-1-21" />
  <meta name="dct.abstract" content="SASL and GSS-API are used for authentication in many application protocols.  This specification extends them to allow credentials of a home realm to be used against external services.  To this end, it introduces end-to-end encryption for SASL that is safe to relay to the client's home realm." />
  <meta name="description" content="SASL and GSS-API are used for authentication in many application protocols.  This specification extends them to allow credentials of a home realm to be used against external services.  To this end, it introduces end-to-end encryption for SASL that is safe to relay to the client's home realm." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">R. Van Rein</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">ARPA2.net</td>
</tr>
<tr>
  <td class="left">Intended status: Informational</td>
  <td class="right">January 21, 2020</td>
</tr>
<tr>
  <td class="left">Expires: July 24, 2020</td>
  <td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Realm Crossover for SASL and GSS-API via Diameter<br />
  <span class="filename">draft-vanrein-diameter-sasl-03</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>SASL and GSS-API are used for authentication in many application protocols.  This specification extends them to allow credentials of a home realm to be used against external services.  To this end, it introduces end-to-end encryption for SASL that is safe to relay to the client's home realm.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on July 24, 2020.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2020 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">Messages of GS2-SXOVER-PLUS</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Initial Client-to-Server Message</a></li>
<li>2.2.   <a href="#rfc.section.2.2">Initial Server-to-Client Message</a></li>
<li>2.3.   <a href="#rfc.section.2.3">Continued Client-to-Server Messages</a></li>
<li>2.4.   <a href="#rfc.section.2.4">Continued Server-to-Client Messages</a></li>
</ul><li>3.   <a href="#rfc.section.3">GS2-SXOVER-PLUS as a GS2 Mechanism</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Encrypting GS2-SXOVER-PLUS Messages</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Initial Round-trip Optimisation</a></li>
<li>3.3.   <a href="#rfc.section.3.3">Initial Header for GSS-API</a></li>
<li>3.4.   <a href="#rfc.section.3.4">Initial Header for SASL</a></li>
</ul><li>4.   <a href="#rfc.section.4">AVP Definitions for SASL in Diameter</a></li>
<ul><li>4.1.   <a href="#rfc.section.4.1">SASL-Mechanism</a></li>
<li>4.2.   <a href="#rfc.section.4.2">SASL-Token</a></li>
<li>4.3.   <a href="#rfc.section.4.3">SASL-Channel-Binding</a></li>
</ul><li>5.   <a href="#rfc.section.5">Diameter Message Requirements for GS2-SXOVER-PLUS</a></li>
<ul><li>5.1.   <a href="#rfc.section.5.1">C2S-Init Requests over Diameter</a></li>
<li>5.2.   <a href="#rfc.section.5.2">S2C-Init Responses over Diameter</a></li>
<li>5.3.   <a href="#rfc.section.5.3">C2S-Cont Requests over Diameter</a></li>
<li>5.4.   <a href="#rfc.section.5.4">S2C-Cont Responses over Diameter</a></li>
</ul><li>6.   <a href="#rfc.section.6">Running Diameter as a SASL Backend</a></li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Diameter is an SCTP service</a></li>
<li>6.2.   <a href="#rfc.section.6.2">Reliance on DANE and DNSSEC</a></li>
</ul><li>7.   <a href="#rfc.section.7">Security Considerations</a></li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a></li>
<li>9.   <a href="#rfc.references">Normative References</a></li>
<li>Appendix A.   <a href="#rfc.appendix.A">Acknowledgements</a></li>
<li><a href="#rfc.authors">Author's Address</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a></h1>
<p id="rfc.section.1.p.1">It is common for Internet users to combine services from a varierity of providers.  Along with this, an ad hoc practice has arisen of using the local identity schemes of these providers.  These are not integrated, and the practice tends to reduce the control of users over their online identity.  A solution to this is support for realm crossover, where an externally acquired service can make a callback to a home realm to authenticate a user's identity and use that for service-specific authorisation.</p>
<p id="rfc.section.1.p.2">SASL <a href="#RFC4422">[RFC4422]</a> is instrumental in authentication across a wide range of application protocols; it allows those protocols to abstract from the actual authentication mechanisms, and at the same time it allows authentication mechanisms to not be concerned about the application protocol.  SASL can easily be funneled from one protocol into another, modulo a number of security concerns.</p>
<p id="rfc.section.1.p.3">Diameter and its Network Access application are instrumental in authenticating a user under a realm, while not providing the resources that an application protocol would imply.  Moreover, Diameter service can be declared under a domain name in a manner that is standardised, scalable and secure.</p>
<pre>
   +--------+    SASL     +--------+    SASL    +---------+
   | Client |-----------&gt; | Server | ---------&gt; |  Realm  |
   +--------+  AppProto   +--------+  Diameter  +---------+
       ||                     ||                    ||
john@example.com        find SRV, TLSA          example.com
  &amp; credential            relay SASL           authentication
</pre>
<p id="rfc.section.1.p.4">This allows a foreign server to authenticate a client to authenticate with its home realm: </p>
<p id="rfc.section.1.p.5">Diameter can send a mere notification of authentication, and the foreign server can use DANE <a href="#RFC6698">[RFC6698]</a> to validate the origin of these notifications.  Diameter in the foreign server will authenticate to the home realm, which may then decide to add resources beyond the basic notification of authentication.</p>
<p id="rfc.section.1.p.6">SASL mechanisms are not generally protected against attacks by men in the middle named Eve.  This is usually compensated for by wrapping the application protocol in TLS, but since that would only protect one leg of the intended realm-crossing authentication exchange, there is a need for end-to-end encryption.  This can be established along with other credentials for the home realm, but an end-to-end mechanism needs to be defined.  This specification introduces a wrapper for that pupose, and nests a SASL exchange with the home realm under its cloak.</p>
<p id="rfc.section.1.p.7">Finally, to avoid the use of one authentication exchange to validate another, it is advisable to incorporate channel binding <a href="#RFC5056">[RFC5056]</a> <a href="#RFC5801">[RFC5801]</a> when making use of backends.  When passing SASL tokens between application protocol and Diameter backend, the channel binding information from the application protocol would be supplied as a side-note to the Diameter backcall.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#sxover-raw" id="sxover-raw">Messages of GS2-SXOVER-PLUS</a></h1>
<p id="rfc.section.2.p.1">GS2-SXOVER-PLUS establishes a session key and continues with an encrypted, but otherwise normal SASL exchange.  This cloak provides end-to-end encryption for the contained SASL exchange, which allows it to be passed through a foreign server.  This section defines the messages involved in the GS2-SXOVER-PLUS exchange in isolation, later sections specify how this fits into GSS-API and SASL contexts, and how these travel to the home realm's network access server.</p>
<p id="rfc.section.2.p.2">By announcing the GS2-SXOVER-PLUS mechanism for SASL, a foreign server declares it is willing to relay SASL messages for that mechanism to the authentication realm indicated by the client in its first GS2-SXOVER-PLUS message in a plaintext form.  Later sections define a standard mechanism for relaying such messages over Diameter, using DNSSEC and DANE so that the result can be trusted to have come from the indicated realm and thus warrant any user name scoped under that realm.  Offering GS2-SXOVER-PLUS does not preclude the offering of other SASL mechanisms; for instance, ANONYMOUS may be useful to allow clients to choose guest access.</p>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#sxover-c2s-init" id="sxover-c2s-init">Initial Client-to-Server Message</a></h1>
<p id="rfc.section.2.1.p.1">The GS2-SXOVER-PLUS exchange is initiated by the client, by sending a C2S-Init message:</p>
<pre>
C2S-Init ::= [APPLICATION 1] IMPLICIT SEQUENCE {
   inictr   Counter,       -- Initial counter value
   keyno    KeyNumber,     -- With realm and encalg, identifies...
   encalg   EncryptAlg,    -- ...the key for svckeymud decryption
   seskey   OCTET STRING   -- RFC 3961 encrypted, key usage 1864
}

Counter ::= INTEGER (0..4294967295)             -- Unsigned 32-bit
KeyNumber ::= INTEGER (0..4294967295)           -- Unsigned 32-bit
EncryptAlg ::= INTEGER (-2147483648..2147483647)  -- Signed 32-bit
</pre>
<p/>
<p id="rfc.section.2.1.p.3">The inictr value is used as a bit of entropy, and will be incremented by one for every next message in the same flow.  This helps to bind messages into one flow and to distinguish among flows.  Though helpful to protect against replay attacks, dynamic challenges and channel binding offer better protection.</p>
<p id="rfc.section.2.1.p.4">The keyno and encalg values present identification information for a key at the Diameter/SASL server, and the seskey is a representation of a session key suitable for decryption with that identified key.  The method by which the keyno and encalg and the key itself are established is not defined here, because its choice is local to the client's realm.  The reason for not authenticating with this key is that anonymous encryption keys are much easier to establish than authentication keys.  One possible mechanism is KIP, the Keyful Identity Protocol, but it is not prescribed herein.</p>
<p id="rfc.section.2.1.p.5">The value of the seskey MAY be locally determined, but by default it SHOULD be a random seed that can serve as input to the random-to-key function with the required key-generation seed-length [Section 3 of <a href="#RFC3961">[RFC3961]</a>] for a session key with the same encryption algorithm enctype as the identified key.  The random seed is protected by encryption to the identified key using the Encrypt function [Section 3 of <a href="#RFC3961">[RFC3961]</a>], which always involves authenticity.  The key usage number is shared from the independent KIP protocol, and is set to KIP_KEYUSAGE_MAPPING or 1864.</p>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#sxover-s2c-init" id="sxover-s2c-init">Initial Server-to-Client Message</a></h1>
<pre>
S2C-Init ::= [APPLICATION 2] IMPLICIT SEQUENCE {
   ctr        Counter,                -- Counter value is inictr+1
   realm      IA5String,              -- Secure realm confirmation
   mechlist   SEQUENCE OF IA5String   -- Available SASL mechanisms
}
</pre>
<p id="rfc.section.2.2.p.1">In both SASL and GSS-API, this first message from server to client is passed as an S2C-Init message: </p>
<p id="rfc.section.2.2.p.2">The first message from the server to the client is named the Initial Response in SASL.  This message presents the client with a choice of mechanism names to use under the cloak of GS2-SXOVER-PLUS.  In addition, it securely confirms the realm name that will be assumed in the upcoming exchange.</p>
<p id="rfc.section.2.2.p.3">GS2-SXOVER-PLUS makes no assumptions about the mechanisms supported at the home realm.  Instead, S2C-Init lists mechanisms specific to the home realm of the client, which are concealed from the foreign server, so it cannot influence the list.</p>
<p id="rfc.section.2.2.p.4">The ctr value is simply inictr incremented by 1, with a wrap-around to stay within an unsigned 32-bit range.  It MUST be validated by the SASL client.  The counter mechanism is both a protection against message resending and a means of having concurrent SASL exchanges if the client wants to.</p>
<p id="rfc.section.2.2.p.5">The realm is repeated from the GS2-SXOVER-PLUS request, but this time it is protected by the session key.  Therefore, the SASL client MUST validate it before starting the wrapped SASL exchange.</p>
<p id="rfc.section.2.2.p.6">The mechlist informs the SASL client of the mechanisms available for authentication against the SASL server.  These can be used for the wrapped SASL exchange.  The list is not related to any mechanism list that the foreign server will have sent before.  Specifically, GS2-SXOVER-PLUS and ANONYMOUS mechanisms should not occur in the wrapped mechlist.  Furthermore, only mechanisms supporting channel binding SHOULD be supported, meaning that all strings in mechlist should have a -PLUS ending.</p>
<h1 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> <a href="#sxover-c2s-cont" id="sxover-c2s-cont">Continued Client-to-Server Messages</a></h1>
<pre>
C2S-Cont ::= [APPLICATION 3] IMPLICIT SEQUENCE {
   ctr       Counter,             -- 1 + Previous ctr value
   c2s       SaslToken,           -- NULL or token, client to server
   mechsel   IA5String OPTIONAL   -- SASL mechanism name selection
}

SaslToken ::= CHOICE {
   token     OCTET STRING,
   no-token  NULL
}
</pre>
<p id="rfc.section.2.3.p.1">Further GS2-SXOVER-PLUS messages from client to server are named (initial) responses by SASL, and they are formed by encrypting the DER-form of C2S-Cont under the seskey.  There is one special case, namely the need for the first C2S-Cont to select a SASL mechanism to run under the seskey cloak.  For all C2S-Cont messages, there is a separate representation for no data, distinguishable from empty data: </p>
<p id="rfc.section.2.3.p.2">This is the first and later of the wrapped SASL messages sent from the client to the server.  When it is the first, the mechsel field MUST specify the SASL mechanism that the client selected from the mechsel issued before.  The mechsel MUST support channel binding, so it must have a -PLUS ending.  In any message, the ctr value is one more than the value in the previous SASL message, reduced to an unsigned 32-bit range; see <a href="#init-optimal">Section 3.2</a> for an important detail caused by round-trip optimisation.</p>
<p id="rfc.section.2.3.p.3">The SaslToken in c2s is either a literal OCTET STRING with the SASL token to pass, or it is NULL if no token is passed.  This implements a distinction between an empty token and no token, as required by SASL <a href="#RFC4422">[RFC4422]</a>.</p>
<h1 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a> <a href="#s2c-cont" id="s2c-cont">Continued Server-to-Client Messages</a></h1>
<pre>
S2C-Cont ::= [APPLICATION 4] IMPLICIT SEQUENCE {
   ctr     Counter,               -- 1 + Previous ctr value
   s2c     SaslToken,             -- NULL or token, server to client
   extra   OCTET STRING OPTIONAL  -- On success, optional extra token
}
</pre>
<p id="rfc.section.2.4.p.1">After the first message from the server to the client, they adhere to the structure of S2C-Cont, defined below.  The SASL term for these messages would be a Challenge that is not an Initial Challenge.  The exchange is encrypted under the seskey: </p>
<p id="rfc.section.2.4.p.2">This is the first and later of the wrapped SASL messages sent from the server to the client.  In any message, the ctr value is one more than the value in the previous SASL message, reduced to an unsigned 32-bit range.</p>
<p id="rfc.section.2.4.p.3">The SaslToken in s2c is either a literal OCTET STRING with the SASL token to pass, or it is NULL if no token is passed.  This implements a distinction between an empty token and no token, as required for SASL.</p>
<p id="rfc.section.2.4.p.4">The extra value can be passed along as a hint to the user for a successful authentication.  Mechanisms do not commonly use the field, but SASL offers it.  The distinction between an empty OCTET STRING and an absent value is assured through the OPTIONAL modifier.  Note that this value should not be passed as part of the GS2-SXOVER-PLUS exchange, as it is part of the SASL mechanism that was selected with mechsel in the wrapped exchange.  GS2-SXOVER-PLUS does not specify an extra value, so the field in the outer SASL exchange that runs GS2-SXOVER-PLUS will not be used.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#mech2gs2" id="mech2gs2">GS2-SXOVER-PLUS as a GS2 Mechanism</a></h1>
<p id="rfc.section.3.p.1">The messages of GS2-SXOVER-PLUS will now be mapped to SASL and GSS-API.  The GS2 bridge <a href="#RFC5056">[RFC5056]</a> defines the requirements to make the two behave equavalently on the basis of a header preceding the first "raw" message which is the C2S-Init message.</p>
<p id="rfc.section.3.p.2">Further messages, so S2C-Init, C2S-Cont and S2C-Cont will be encrypted but otherwise used as-is under both SASL and GSS-API.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> Encrypting GS2-SXOVER-PLUS Messages</h1>
<p id="rfc.section.3.1.p.1">Before inclusion in the GSS-API and SASL frames, most GS2-SXOVER-PLUS messages will be encrypted: <a href="#RFC3961">[RFC3961]</a>] uses default initial state and is known to also guarantee integrity.  The name KIP references the compatible Keyful Identity Protocol, which may or may not develop independently of GS2-SXOVER-PLUS.</p>

<dl>
  <dt>C2S-Init</dt>
  <dd style="margin-left: 6">is not encrypted, but it contains a seskey field that is encrypted under the long-term key with key usage value KIP_KEYUSAGE_MAPPING or 1864;</dd>
  <dt>S2C-Init, C2S-Cont, S2C-Cont</dt>
  <dd style="margin-left: 6">are encrypted under the seskey, as supplied in the C2S-Init that started the session, with key usage value KIP_KEYUSAGE_USERDATA or 1863.</dd>
</dl>

<p> The encrypt operation [Section 3 of </p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#init-optimal" id="init-optimal">Initial Round-trip Optimisation</a></h1>
<p id="rfc.section.3.2.p.1">This section introduces an optimisation that MUST be accepted by servers, and MAY be sent by clients.  In addition, the server MAY use it in response to optimised messages to clients which MUST then accept it.</p>
<p id="rfc.section.3.2.p.2">Normally, the C2S-Init, S2C-Init, C2S-Cont and S2C-Cont messages are all placed in a single GSS-API or SASL message, with encryption and headers applied as dictated for each occasion.  The optimisation described here concatenates an opportunistic C2S-Cont to C2S-Init, and upon acceptance of the opportunistic attempt the server sends not only a S2C-Init, but also the accepting S2C-Cont.</p>
<p id="rfc.section.3.2.p.3">Encryption is applied to the GS2-SXOVER-PLUS messages before they are concatenated.  The header is applied after concatenation.</p>
<pre>
     Message   |  Counter on success  |  Counter on failure
     ----------+----------------------+--------------------
     C2S-Init  |  inictr              |  inictr
     C2S-Cont  |  inictr + 2          |  inictr + 2
     S2C-Init  |  inictr + 1          |  inictr + 1
     S2C-Cont  |  inictr + 3          |  (message absent)
     next...   |  inictr + 4,5,6...   |  inictr + 3,4,5...
</pre>
<p id="rfc.section.3.2.p.4">The Counter values used in case of success or failure of the opportunistic attempt are: </p>
<p id="rfc.section.3.2.p.5">The use of this pattern is that a mechanism may be tried immediately, without awaiting the mechanism list.  Very often, clients will be setup to validate using a particular mechanism, or they may have learnt from a prior exchange.  This is particularly useful because traffic concentrates at the home realm, which usually leads to a stable mechanism list.</p>
<h1 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> <a href="#mech2gssapi" id="mech2gssapi">Initial Header for GSS-API</a></h1>
<p id="rfc.section.3.3.p.1">The header to use for GSS-API is standardised as a Mechanism-Independent Token Format [Section 3.1 of <a href="#RFC2743">[RFC2743]</a>] and prefixed to the initial token of a GSS-API context establishment sequence, incorporating the object identifier 1.3.6.1.4.1.44469.666.5081.1 (TBD:GSSOID) to identify GS2-SXOVER-PLUS.  When this object identifier is supplied to the call GSS_Inquire_SASLname_for_mech [Section 10 of <a href="#RFC5801">[RFC5801]</a>], the output reads "GS2-SXOVER-PLUS" (without the quotes).</p>
<pre>
GSS-SXOVER-Init ::= SEQUENCE {
  gs2-authzid  IA5String,
  c2s-init     C2S-Init
}
</pre>
<p id="rfc.section.3.3.p.2">Following the header is a GSS-API variant of C2S-Init, which prefixes an authorization identity, interpreted as defined in the GS2 header for SASL.  The structure after the header in ASN.1 notation is: </p>
<pre>
   60 02 ...length...   -- [APPLICATION 0] IMPLICIT SEQUENCE { ... }
      -- OBJECT IDENTIFIER 1.3.6.1.4.1.44469.666.5081.1 (TBD:GSSOID)
      06 ...length... 2b 06 01 04 01 44469 TBD:666 TBD:5081 01  -- OBJECT IDENTIFIER
      -- GSS-SXOVER-Init
      30 ...length...  -- SEQUENCE { ... }
         ...
</pre>
<p id="rfc.section.3.3.p.3">The annotated bytes are shown below: </p>
<p id="rfc.section.3.3.p.4">The mapping of GS2-SXOVER-PLUS into GSS-API is less natural than into SASL, because it references SASL mechanisms.  This is not a strict problem however, and implementers MAY provide GS2-SXOVER-PLUS as a GSS-API mechanism.  The absense of a realm name in the generic parts of the protocol may however lead to difficulties routing.</p>
<p id="rfc.section.3.3.p.5">The function GSS_Inquire_SASLname_for_mech [Section 10 of <a href="#RFC5801">[RFC5801]</a>] maps the aforementioned object identifier for the GSS-API mechanism to the name "GS2-SXOVER-PLUS" (without quotes).</p>
<h1 id="rfc.section.3.4"><a href="#rfc.section.3.4">3.4.</a> <a href="#mech2sasl" id="mech2sasl">Initial Header for SASL</a></h1>
<p id="rfc.section.3.4.p.1">The header to use for SASL is the gs2-header <a href="#RFC5801">[RFC5801]</a> with a few extra constraints: constrained than its general form, namely: </p>

<dl>
  <dt>gs2-nonstd-flag</dt>
  <dd style="margin-left: 6">is absent;</dd>
  <dt>gs2-cb-flag</dt>
  <dd style="margin-left: 6">MUST NOT be "y" or "n" because channel binding is required; the only remaining general form is therefore ("p=" cb-name); a foreign server MUST interpret this flag and relay the appropriate channel binding information through its Diameter backend;</dd>
  <dt>gs2-authzid</dt>
  <dd style="margin-left: 6">is used for routing of C2S-Init to the Diameter server of the authoritative backend realm.  This field MUST contain at least one AT symbol U+0040.  The domain name for the backend is mentioned after the last AT symbol.  Anything preceding the AT symbol is interpreted by the local realm, and MAY be used for realm-internal routing to a more specific Diameter backend service node, but identification is done within the realm by the inner SASL layer, and the foreign server MUST NOT rely on text before the last AT symbol.</dd>
</dl>
<pre>
p=tls-unique,@example.com,
</pre>
<pre>
p=tls-unique,+idp+sxover@example.com,
</pre>
<p id="rfc.section.3.4.p.2">As an example, the gs2-header targeting a realm "example.com" and channel binding through tls-unique could be </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#spec.avps" id="spec.avps">AVP Definitions for SASL in Diameter</a></h1>
<p id="rfc.section.4.p.1">SASL messages in Diameter use a number of AVPs [Section 4 of <a href="#RFC6733">[RFC6733]</a>] that are combined to relay SASL to an authentication realm.</p>
<p id="rfc.section.4.p.2">These AVPs are added to the set that is used with the Network Access Server application <a href="#RFC7155">[RFC7155]</a>, and can therefore be used in AA-Request and AA-Answer messages.  On top of that, the SASL-Mechanism AVP may also occur in a Capabilities Exchange Answer.  The User-Name AVP MUST be supplied in a successful AA-Answer to inform the server about the user name that the backend decided on; the server MAY send a hint requesting a value in the User-Name AVP in the AA-Request.</p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> <a href="#spec.avps.mech" id="spec.avps.mech">SASL-Mechanism</a></h1>
<p id="rfc.section.4.1.p.1">The SASL-Mechanism AVP has AVP Code TBD0.  This specification only uses the mechanism name GS2-SXOVER-PLUS as a value for this AVP.  It MUST be included in the first message of an GS2-SXOVER-PLUS exchange sent to the home realm, and it SHOULD be verified by the home realm upon reception.  Its purpose is mostly to distinguish this specification from potential future specifications to encapsulate SASL in Diameter.</p>
<p id="rfc.section.4.1.p.2">Though not used in this specification, this AVP may also be supplied from the home realm to the Diameter client to hold a space-separated list of SASL mechanisms.</p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> <a href="#spec.avps.token" id="spec.avps.token">SASL-Token</a></h1>
<p id="rfc.section.4.2.p.1">The SASL-Token AVP has AVP Code TBD1.  SASL requires distinction between empty and absent tokens; absent SASL tokens are represented by absence of the SASL-Token AVP and empty SASL tokens are represented as a present SASL-Token AVP with zero content bytes.</p>
<h1 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> <a href="#spec.avps.chanbind" id="spec.avps.chanbind">SASL-Channel-Binding</a></h1>
<p id="rfc.section.4.3.p.1">The SASL-Channel-Binding AVP has AVP Code TBD2.  It MUST appear along the first SASL-Token AVP for a Network Access session if the SASL-Mechanism ends in -PLUS.</p>
<p id="rfc.section.4.3.p.2">This AVP may occur more than once, to indicate support of multiple forms of channel binding.  Note however that all mechanisms suitable for Diameter relaying use the GS2 bridge <a href="#RFC5056">[RFC5056]</a> in which case the channel binding name to pass along in this message can be derived.</p>
<p id="rfc.section.4.3.p.3">When the client connects to the foreign service over TLS, the tls-unique form <a href="#RFC5929">[RFC5929]</a> of channel binding is RECOMMENDED.  Specific foreign servers may however be exempted by the home realm.</p>
<p id="rfc.section.4.3.p.4">The contents of this AVP concatenates two values: </p>

<dl>
  <dt>name</dt>
  <dd style="margin-left: 6">is the standard name of the channel binding information, followed by a zero-valued byte.</dd>
  <dt>value</dt>
  <dd style="margin-left: 6">contains the bytes of the channel binding information.</dd>
</dl>
<p id="rfc.section.4.3.p.5">Normally, channel binding information should be sourced from the underlying communications channel, but this information is not available to a SASL backend running Diameter.  To enable channel binding between the end points, the foreign server incorporates the channel binding information that the client can use in its connection to the foreign server.  This is useful to mitigate replay attacks, which is why its use is RECOMMENDED.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#spec.diameter" id="spec.diameter">Diameter Message Requirements for GS2-SXOVER-PLUS</a></h1>
<p id="rfc.section.5.p.1">This section explains how the various GS2-SXOVER-PLUS messages are forwarded over Diameter by the foreign server.  The foreign server is connected to the SASL client, usually over a TLS connection, and relays requests over Diameter, usually over SCTP with DTLS.</p>
<p id="rfc.section.5.p.2">Diameter servers provide success and failure responses, based on the corresponding final results from a SASL service that they in turn use.  When no such final result comes from a Diameter request, a challenge will instead be produced over Diameter, holding a SASL challenge token from the server.</p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#c2s-init-diam" id="c2s-init-diam">C2S-Init Requests over Diameter</a></h1>
<p id="rfc.section.5.1.p.1">To send C2S-Init, possibly including the C2S-Cont that the optimisation adds, the Diameter client MUST include at least the following AVPs in an AA-Request [Section 3.1 of <a href="#RFC7155">[RFC7155]</a>]: </p>

<dl>
  <dt>Realm</dt>
  <dd style="margin-left: 6">is the client's requested realm, replicated here for routing purposes; GS2-SXOVER-PLUS provides this value in the gs2-header's authorization identity field;</dd>
  <dt>SASL-Mechanism</dt>
  <dd style="margin-left: 6">is set to the fixed string GS2-SXOVER-PLUS;</dd>
  <dt>SASL-Token</dt>
  <dd style="margin-left: 6">is set to the C2S-Init and optional C2S-Cont as it arrived from the SASL client;</dd>
  <dt>SASL-Channel-Binding</dt>
  <dd style="margin-left: 6">is set to the channel binding information for the connection in which the SASL client attempts authentication, adhering to the channel binding mechanism named in the gs2-header in the SASL-Token.</dd>
</dl>
<p id="rfc.section.5.1.p.2">It is possible to extend the message with more AVPs if the client and server have agreed on this, perhaps as a result of capability negotiation during Diameter connection setup.</p>
<p id="rfc.section.5.1.p.3">The C2S-Init Request is likely to hold other Diameter AVPs for general housekeeping of Diameter in general and the NAS application, such as Session-Id.  Though User-Name and User-Password would be sent with password-based Diameter mechanisms, they are not required in C2S-Init messages, but they MAY be sent with empty contents to accommodate software and the RECOMMENDED status of the AVPs in the AA-Request, in which case they MUST be ignored on reception.</p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#s2c-init-diam" id="s2c-init-diam">S2C-Init Responses over Diameter</a></h1>
<p id="rfc.section.5.2.p.1">The Diameter server serves as a SASL server to which the foreign server relays requests.  To this end, the Diameter server responds with acceptance, denial or a further challenge.  Acceptance and denial are used for the corresponding SASL outcomes, the further challenge also matches logically.</p>
<p id="rfc.section.5.2.p.2">When the SASL server responds with S2C-Init over Diameter, the Diameter server MUST include at least the following AVPs in a successful AA-Answer [Section 3.2. of <a href="#RFC7155">[RFC7155]</a>]: </p>

<dl>
  <dt>User-Name</dt>
  <dd style="margin-left: 6">is set to the identity of the SASL client, which resulted from the encapsulated SASL exchange and possibly further authorisation processing in the SASL server; the name MUST NOT add the realm name in this attribute; it is up to the foreign server to assign it under the authoritative realm, possibly by appending the last U+0040 (AT) character and its realm name observed from the GS2 header sent in C2S-Init over Diameter.</dd>
  <dt>Permissions</dt>
  <dd style="margin-left: 6">may be expected from a Diameter server, but are considered optional for SASL over Diameter.  The reason is that SASL focusses on authentication, not authorisation.  This especially applies to realm crossover, where authentication is a matter of the home realm and authorisation is, at least by default, the prerogative of the foreign server implementing its own resource with its own semantics.  Extensions to this specification could however be made to use the infrastructure proposed herein to also centralise the storage and/or processing of resource access rights.</dd>
</dl>

<p> If the SASL exchange requires continuation, then the AA-Answer represents a challenge to follow up, represented in the an AA-Answer that MUST include at least the following AVPs: </p>

<dl>
  <dt>Result-Code</dt>
  <dd style="margin-left: 6">is set to the value DIAMETER_MULTI_ROUND_AUTH;</dd>
  <dt>SASL-Token</dt>
  <dd style="margin-left: 6">is set to the S2C-Init value;</dd>
  <dt>State</dt>
  <dd style="margin-left: 6">is set to server state to be reproduced in the followup.</dd>
</dl>

<p> If the AA-Answer is a final failure report, this MUST be represented in a failing Result-Code AVP.  </p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> <a href="#c2s-cont-diam" id="c2s-cont-diam">C2S-Cont Requests over Diameter</a></h1>
<p id="rfc.section.5.3.p.1">The C2S-Cont message is any further message that the SASL client passes to the foreign server.  It is forwarded as a Diameter AA-Request [Section 3.1 of <a href="#RFC7155">[RFC7155]</a>] which MUST contain at least the following AVP: </p>

<dl>
  <dt>SASL-Token</dt>
  <dd style="margin-left: 6">is set to the token from the SASL client.</dd>
</dl>
<p id="rfc.section.5.3.p.2">The C2S-Cont Request MUST NOT contain AVPs for SASL-Mechanism or SASL-Channel-Binding.  It is however likely to hold other Diameter AVPs for general housekeeping of Diameter in general and the NAS application, such as Session-Id and State AVPs.  Though User-Password would be sent with password-based mechanisms, it is not required in C2S-Cont messages, but it MAY be sent with empty contents to accommodate software and the RECOMMENDED status of the AVP, in which case it MUST be ignored on reception.</p>
<h1 id="rfc.section.5.4"><a href="#rfc.section.5.4">5.4.</a> <a href="#s2c-cont-diam" id="s2c-cont-diam">S2C-Cont Responses over Diameter</a></h1>
<p id="rfc.section.5.4.p.1">The S2C-Cont Response message may inform the Diameter client of success, failure or a further challenge.  It is transmitted over Diameter as a Diameter AA-Answer [Section 3.2 of <a href="#RFC7155">[RFC7155]</a>] message, with the customary Result-Code interpretations.</p>
<p id="rfc.section.5.4.p.2">Processing of these Diameter messages is the same as for S2C-Init, with the exception that the SASL-Token, if it is present, is not interpreted as S2C-Init but as S2C-Cont.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#run" id="run">Running Diameter as a SASL Backend</a></h1>
<p id="rfc.section.6.p.1">Following are a few practical considerations in relation to the Diameter connectivity for SASL.</p>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> <a href="#run.sctp" id="run.sctp">Diameter is an SCTP service</a></h1>
<p id="rfc.section.6.1.p.1">Diameter is primarily an SCTP-based protocol <a href="#RFC6733">[RFC6733]</a>, for reasons of scalabaility and efficiency.  SASL Diameter benefits from these properties and embraces the SCTP carrier.  Operating system support for SCTP is wide-spread, but parts of network infrastructure may not support it, and that may cause implementations to add a fallback to more traditional protocols.  Standards offer two options for doing this.</p>
<p id="rfc.section.6.1.p.2">Diameter can fallback to run over TCP, which is mostly of use to client-only machines, but then sacrifices several benefits of the SCTP carrier.  SASL Diameter embeddings typically involve no client systems, so this option is NOT RECOMMENDED.</p>
<p id="rfc.section.6.1.p.3">SCTP may be run over a UDP transport using port 9899 <a href="#RFC6951">[RFC6951]</a>, which does not sacrifice much; it only inserts a UDP header before each message.  This is a reasonable expectation of foreign servers as well as home realms, so this additional option is RECOMMENDED for situations where a fallback for plain SCTP is desired.  It is standardised as a socket option SCTP_REMOTE_UDP_ENCAPS_PORT, and only involves a small repetition in code, with a minor change between the attempts.</p>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> <a href="#run.dnssec" id="run.dnssec">Reliance on DANE and DNSSEC</a></h1>
<p id="rfc.section.6.2.p.1">Diameter always involves the use of TLS, but there is a number of choices concerning the validation of connections through DNSSEC and DANE.  It is the home realm's prerogative what level of protection it upholds for its client identities, but any foreign server can choose to raise the bar by setting a minimum standard.</p>
<p id="rfc.section.6.2.p.2">DNSSEC offers a protection mechanism for the _diameter._sctp SRV records that lead to the Diameter host and its port for the home realm.  This does not protect against forged IP addresses, port mappings or routing.  To protect against this as well, a TLSA record for the service host and port, along with the _sctp protocol label, can be used as specified for DANE <a href="#RFC6698">[RFC6698]</a>.  This use of DNSSEC and DANE is RECOMMENDED.</p>
<p id="rfc.section.6.2.p.3">Home realms that choose to be light on such measures risk that identities are forged, in spite of their use of TLS.  Foreign servers MAY choose to reject such home realms, or alternatively be more inquisitive about the certificates used.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> Security Considerations</h1>
<p id="rfc.section.7.p.1">The SASL mechanism GS2-SXOVER-PLUS separates the authentication of a foreign identity into its realm and the username underneath it.  The realm is authenticated by the relying server, such as the proposed foreign server, whereas the username is obtained from a backend realm server that is known to be responsible for that realm.</p>
<p id="rfc.section.7.p.2">From the perspective of the foreign server, assurance of an identity is the vital aspect of the GS2-SXOVER-PLUS flow that it relays over Diameter.  Through TLS or DTLS, with DNSSEC and DANE to validate the certificate it uses, the link from a realm (which is read as a domain name) to the Diameter connection can be verified, so the relying server can be certain about the realm under which the backend connection resides.  By receiving a response over that connection to a known-authoritative server for the realm, the username can also be trusted.  The relying server continues to treat the username and realm as a pair the for identification of the user.</p>
<p id="rfc.section.7.p.3">Channel binding is normally limited to two parties only, and forwarding such information is not a trivial idea.  The fact that the forwarding connection is encrypted, and known to lead to an authoritative server for a claimed realm does help.  The intermediate server relies on proper authentication, and has no interest in bypassing authentication, and it would be doing that by adopting channel binding information from anywhere else.</p>
<p id="rfc.section.7.p.4">From the perspective of the client and the home realm, the safety of the SASL credentials is paramount.  When addressing a foreign server, which is not part of the home realm, clients therefore MUST NOT rely on mechanisms that might leak credentials.  Two mechanisms that are safe to use are ANONYMOUS, which passes no credentials and assigns no rights, and GS2-SXOVER-PLUS, which applies end-to-end encryption to another SASL mechanism that may or may not be secure.</p>
<p id="rfc.section.7.p.5">The GS2-SXOVER-PLUS mechanism uses channel binding to ensure that the authentication is specific to a stream.  The level to which this is secure depends on the channel binding mechanism.  Therefore, in spite of end-to-end encryption, most use cases will want a secure carrier such as TLS between the client and foreign server.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> IANA Considerations</h1>
<pre>
AVP Code | Attribute Name       | Reference
---------+----------------------+------------
TBD0     | SASL-Mechanism       | (this spec)
TBD1     | SASL-Token           | (this spec)
TBD2     | SASL-Channel-Binding | (this spec)
</pre>
<p id="rfc.section.8.p.1">This specification defines three AVP Codes for use with Diameter.  IANA registers the following AVP Codes for them in the "Authentication, Authorization, and Accounting (AAA) Parameters" registry: </p>
<h1 id="rfc.references"><a href="#rfc.references">9.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2743">[RFC2743]</b>
      </td>
      <td class="top"><a>Linn, J.</a>, "<a href="http://tools.ietf.org/html/rfc2743">Generic Security Service Application Program Interface Version 2, Update 1</a>", RFC 2743, DOI 10.17487/RFC2743, January 2000.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3961">[RFC3961]</b>
      </td>
      <td class="top"><a>Raeburn, K.</a>, "<a href="http://tools.ietf.org/html/rfc3961">Encryption and Checksum Specifications for Kerberos 5</a>", RFC 3961, DOI 10.17487/RFC3961, February 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4422">[RFC4422]</b>
      </td>
      <td class="top"><a>Melnikov, A.</a> and <a>K. Zeilenga</a>, "<a href="http://tools.ietf.org/html/rfc4422">Simple Authentication and Security Layer (SASL)</a>", RFC 4422, DOI 10.17487/RFC4422, June 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5056">[RFC5056]</b>
      </td>
      <td class="top"><a>Williams, N.</a>, "<a href="http://tools.ietf.org/html/rfc5056">On the Use of Channel Bindings to Secure Channels</a>", RFC 5056, DOI 10.17487/RFC5056, November 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5801">[RFC5801]</b>
      </td>
      <td class="top"><a>Josefsson, S.</a> and <a>N. Williams</a>, "<a href="http://tools.ietf.org/html/rfc5801">Using Generic Security Service Application Program Interface (GSS-API) Mechanisms in Simple Authentication and Security Layer (SASL): The GS2 Mechanism Family</a>", RFC 5801, DOI 10.17487/RFC5801, July 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5929">[RFC5929]</b>
      </td>
      <td class="top"><a>Altman, J.</a>, <a>Williams, N.</a> and <a>L. Zhu</a>, "<a href="http://tools.ietf.org/html/rfc5929">Channel Bindings for TLS</a>", RFC 5929, DOI 10.17487/RFC5929, July 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6698">[RFC6698]</b>
      </td>
      <td class="top"><a>Hoffman, P.</a> and <a>J. Schlyter</a>, "<a href="http://tools.ietf.org/html/rfc6698">The DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS) Protocol: TLSA</a>", RFC 6698, DOI 10.17487/RFC6698, August 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6733">[RFC6733]</b>
      </td>
      <td class="top"><a>Fajardo, V.</a>, <a>Arkko, J.</a>, <a>Loughney, J.</a> and <a>G. Zorn</a>, "<a href="http://tools.ietf.org/html/rfc6733">Diameter Base Protocol</a>", RFC 6733, DOI 10.17487/RFC6733, October 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6951">[RFC6951]</b>
      </td>
      <td class="top"><a>Tuexen, M.</a> and <a>R. Stewart</a>, "<a href="http://tools.ietf.org/html/rfc6951">UDP Encapsulation of Stream Control Transmission Protocol (SCTP) Packets for End-Host to End-Host Communication</a>", RFC 6951, DOI 10.17487/RFC6951, May 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7155">[RFC7155]</b>
      </td>
      <td class="top"><a>Zorn, G.</a>, "<a href="http://tools.ietf.org/html/rfc7155">Diameter Network Access Server Application</a>", RFC 7155, DOI 10.17487/RFC7155, April 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#ack" id="ack">Acknowledgements</a></h1>
<p id="rfc.section.A.p.1">Thanks to Nico Williams for input on the GS2 bridge and Channel Binding.</p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Rick van Rein</span> 
	  <span class="n hidden">
		<span class="family-name">Van Rein</span>
	  </span>
	</span>
	<span class="org vcardline">ARPA2.net</span>
	<span class="adr">
	  <span class="vcardline">Haarlebrink 5</span>

	  <span class="vcardline">
		<span class="locality">Enschede</span>,  
		<span class="region">Overijssel</span> 
		<span class="code">7544 WP</span>
	  </span>
	  <span class="country-name vcardline">The Netherlands</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:rick@openfortress.nl">rick@openfortress.nl</a></span>

  </address>
</div>

</body>
</html>
